<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Premier League â€” Embedded</title>
<style>
  :root{--bg:#000;--ui:#fff}
  html,body{
    margin:0;
    height:100%;
    background:var(--bg);
    color:var(--ui);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  }
  #frame-wrap{
    width:100%;
    height:100%;
    position:relative;
    overflow:hidden;
  }
  iframe{
    width:100%;
    height:100%;
    border:0;
    display:block;
    background:#000;
  }
  /* full-screen overlay to block interaction until user taps */
  #tap-overlay{
    position:fixed;
    top:0;
    left:0;
    width:100vw;
    height:100vh;
    background:transparent;
    cursor:pointer;
    touch-action:manipulation;
    z-index:9999;
  }
  /* small visible unmute hint */
  #unmute-hint{
    position:absolute;
    right:12px;
    top:12px;
    padding:8px 10px;
    border-radius:8px;
    background:rgba(0,0,0,0.5);
    color:var(--ui);
    font-size:13px;
    backdrop-filter:blur(4px);
    z-index:10000;
    display:flex;
    gap:8px;
    align-items:center;
    pointer-events:auto;
  }
  #error{
    display:none;
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    background:rgba(0,0,0,0.75);
    padding:20px;
    text-align:center;
    z-index:10001;
  }
  button.icon-btn{
    background:transparent;
    border:0;
    color:var(--ui);
    font-size:14px;
    padding:6px;
    cursor:pointer;
  }
</style>
</head>
<body>
<div id="frame-wrap" aria-live="polite"></div>
<div id="error">Failed to load stream.</div>

<script>
const encodedParts = [
  "aHR0cHM6Ly9zdHJlYW1jcmljaGQuY29t",
  "L3VwZGF0ZS9za3lzNS5waHA="
];
const encoded = encodedParts.join('');
let streamUrl;
try {
  streamUrl = atob(encoded);
} catch (e) {
  console.error('Decoding failed', e);
  showError();
}

const wrap = document.getElementById('frame-wrap');

function showError(){
  document.getElementById('error').style.display = 'flex';
}

// create initial muted iframe for autoplay
function createInitialIframe(){
  const iframe = document.createElement('iframe');
  iframe.setAttribute('allow', 'autoplay; fullscreen; picture-in-picture');
  iframe.setAttribute('allowfullscreen', '');
  iframe.setAttribute('playsinline', '');
  iframe.setAttribute('muted', '');
  iframe.src = streamUrl;
  iframe.addEventListener('error', () => {
    iframe.style.display = 'none';
    showError();
  });
  return iframe;
}

// create unmuted iframe after user gesture
function createUnmutedIframe(){
  const iframe = document.createElement('iframe');
  iframe.setAttribute('allow', 'autoplay; fullscreen; picture-in-picture');
  iframe.setAttribute('allowfullscreen', '');
  iframe.setAttribute('playsinline', '');
  const sep = streamUrl.includes('?') ? '&' : '?';
  iframe.src = streamUrl + sep + '_=' + Date.now();
  iframe.addEventListener('error', () => {
    iframe.style.display = 'none';
    showError();
  });
  return iframe;
}

if(streamUrl){
  const initial = createInitialIframe();
  wrap.appendChild(initial);

  // overlay to block interaction
  const overlay = document.createElement('div');
  overlay.id = 'tap-overlay';
  overlay.title = 'Tap to enable audio';

  // visible hint
  const hint = document.createElement('div');
  hint.id = 'unmute-hint';
  hint.innerHTML = '<span style="font-weight:600;font-size:13px">Tap to unmute</span>';

  document.body.appendChild(overlay);
  document.body.appendChild(hint);

  const onFirstTap = (ev) => {
    ev.preventDefault();
    overlay.removeEventListener('click', onFirstTap);
    overlay.removeEventListener('touchend', onFirstTap);
    overlay.remove();
    hint.remove();

    const unmuted = createUnmutedIframe();
    if(initial && initial.parentNode) initial.parentNode.removeChild(initial);
    wrap.appendChild(unmuted);
  };

  overlay.addEventListener('click', onFirstTap, {passive:false});
  overlay.addEventListener('touchend', onFirstTap, {passive:false});

  // fallback: check if iframe loaded
  setTimeout(()=>{
    try{
      const doc = initial.contentDocument || initial.contentWindow.document;
      if(!doc || !doc.body || doc.body.innerHTML.trim()===''){
        initial.style.display='none';
        showError();
      }
    }catch(err){}
  },3000);
}else{
  showError();
}
</script>
</body>
</html>
